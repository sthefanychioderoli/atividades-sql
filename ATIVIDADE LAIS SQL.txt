/* atividade 1*/
UPDATE DEBITOS D
SET SITUACAO_DEBITO = 'Atrasado'
WHERE DATAVENCIMENTO < CURRENT_DATE
AND SITUACAO_DEBITO NOT IN ('Negociado', 'Pago');

SELECT * FROM DEBITOS d 
WHERE DATAVENCIMENTO < CURRENT_DATE
AND SITUACAO_DEBITO NOT IN ('Negociado', 'Pago')


/* atividade 2*/
UPDATE DEBITOS D
SET SITUACAO_DEBITO = 'Pendente'
WHERE DATAVENCIMENTO < CURRENT_DATE
AND SITUACAO_DEBITO NOT IN ('Pago');

SELECT * FROM DEBITOS d 
WHERE DATAVENCIMENTO < CURRENT_DATE
AND SITUACAO_DEBITO NOT IN ('Pago');


/* atividade 3*/
UPDATE DEBITOS d 
SET DATAVENCIMENTO = DATEADD(-5 YEAR TO DATAVENCIMENTO) 
WHERE SITUACAO_DEBITO IN ('Negociado');

SELECT * FROM DEBITOS d
WHERE SITUACAO_DEBITO IN ('Negociado');


/* atividade 4*/
SELECT p.NOME, p.EMAIL, p.TELEFONE FROM PESSOA p 


/* atividade 5*/
SELECT p.PRECO_UNITARIO FROM PRODUTO p 
WHERE p.PRECO_UNITARIO > 100


/* atividade 6*/
SELECT v.DATA_VENDA FROM VENDA v 
WHERE v.DATA_VENDA = '2022/04/01'


/*Atividade 7*/
SELECT p.NOME, p.DATA_NASCIMENTO, (CURRENT_DATE - p.DATA_NASCIMENTO) FROM FORNECEDOR f
LEFT JOIN PESSOA p ON p.ID_PESSOA = f.ID_FORNECEDOR 
WHERE f.ID_FORNECEDOR IN (SELECT ID_FORNECEDOR FROM PRODUTO p2 WHERE QUANTIDADE_ESTOQUE IS NULL)


/*Atividade 8*/
SELECT P.NOME FROM CLIENTE C
JOIN PESSOA P ON C.ID_PESSOA = P.ID_PESSOA
JOIN DEBITOS D ON C.ID_CLIENTE = D.ID_CLIENTE
WHERE D.DATAVENCIMENTO < CURRENT_DATE
AND D.SITUACAO_DEBITO <> 'PAGO'

/*Atividade 10*/
SELECT FIRST 10 c.ID_CLIENTE 
     , p.NOME
     , EXTRACT(YEAR FROM CURRENT_DATE) - EXTRACT(YEAR FROM p.DATA_NASCIMENTO) AS IDADE
     , COALESCE( (SELECT SUM(d.VALOR_TOTAL)
             FROM DEBITOS d 
            WHERE d.ID_CLIENTE = c.ID_CLIENTE 
              AND d.DATAVENCIMENTO < CURRENT_DATE 
              AND D.SITUACAO_DEBITO IN ('Atrasado', 'Pendente')),0) AS debito_pendente
	 , (SELECT SUM(d.VALOR_TOTAL)
          FROM DEBITOS d 
         WHERE d.ID_CLIENTE = c.ID_CLIENTE      
           AND D.SITUACAO_DEBITO = 'Pago') AS debito_pago           
FROM PESSOA p 
INNER JOIN CLIENTE c ON C.ID_PESSOA  = P.ID_PESSOA 
ORDER BY 4 DESC 

/*Atividade 11*/
UPDATE PRODUTO p 
SET PRECO_UNITARIO = PRECO_UNITARIO + (PRECO_UNITARIO * 10)
WHERE p.QUANTIDADE_ESTOQUE < 10

SELECT * FROM PRODUTO p 
WHERE p.QUANTIDADE_ESTOQUE < 10


/*Atividade 13*/
UPDATE DEBITOS D
SET D.SITUACAO_DEBITO = 'Pago'
WHERE D.SITUACAO_DEBITO = 'Atrasado'
AND EXISTS (SELECT 1  FROM PAGAMENTO P 
WHERE P.ID_DEBITO = D.ID_DEBITO)

/*Atividade 15*/
SELECT * FROM VENDA v 
WHERE v.DATA_VENDA BETWEEN  '2023-12-01' AND '2024-01-01'

/*Atividade 16*/
SELECT * FROM PRODUTO p 
WHERE p.QUANTIDADE_ESTOQUE BETWEEN 5 AND 20

/*Atividade 17*/
SELECT * FROM PESSOA p 
WHERE p.NOME LIKE 'A%'

/*Atividade 18*/
SELECT * FROM PRODUTO p 
LEFT JOIN ITENSVENDA i ON p.ID_PRODUTO = i.ID_VENDA 
WHERE i.ID_VENDA IS NULL

/*Atividade 19*/
SELECT P.NOME AS NOME_PRODUTO, IV.QUANTIDADE FROM PRODUTO P
JOIN ITENSVENDA IV ON P.ID_PRODUTO = IV.ID_PRODUTO
JOIN VENDA V ON IV.ID_VENDA = V.ID_VENDA
WHERE V.ID_PESSOA IN (3, 11)  

/*Atividade 20*/
SELECT * FROM PESSOA p 
WHERE p.ID_PESSOA IN (SELECT ID_PESSOA FROM CLIENTE C WHERE c.ID_PESSOA IS NOT NULL) OR 
p.ID_PESSOA IN (SELECT ID_PESSOA FROM FORNECEDOR f WHERE f.ID_PESSOA IS NOT NULL)

/*Atividade 21*/
SELECT V.*, C.*, FP.DESCRICAO AS FORMA_PAGAMENTO FROM VENDA V
JOIN CLIENTE C ON V.ID_PESSOA = C.ID_PESSOA
JOIN FORMA_PAGAMENTO FP ON V.ID_FORMA_PAGAMENTO = FP.ID_FORMA_PAGAMENTO


/*Atividade 22*/
SELECT V.*, IV.*, P.* FROM VENDA V
JOIN ITENSVENDA IV ON V.ID_VENDA = IV.ID_VENDA
JOIN PRODUTO P ON IV.ID_PRODUTO = P.ID_PRODUTO
WHERE P.NOME = 'Placa de Captura'

/*Atividade 23*/
SELECT (CURRENT_DATE - DATA_NASCIMENTO)/365 + 1 AS IDADE2025  FROM pessoa p
WHERE p.ID_PESSOA IN (SELECT ID_PESSOA FROM CLIENTE c WHERE c.ID_PESSOA IS NOT NULL) OR 
p.ID_PESSOA IN (SELECT ID_PESSOA FROM FORNECEDOR f WHERE f.ID_PESSOA IS NOT NULL)


/*Atividade 24*/
SELECT * FROM LOGRADOURO l
WHERE l.ID_LOGRADOURO IN (SELECT ID_LOGRADOURO FROM ENDERECO e WHERE e.ID_LOGRADOURO IS NOT NULL)

/*Atividade 25*/
SELECT * FROM PRODUTO p
WHERE P.PRECO_UNITARIO > (SELECT AVG(P2.PRECO_UNITARIO) FROM PRODUTO P2)

/*Atividade 26*/
SELECT DISTINCT C.*
FROM CLIENTE C
JOIN VENDA V ON C.ID_PESSOA = V.ID_PESSOA
JOIN ENDERECO E ON E.ID_PESSOA = C.ID_PESSOA
JOIN MUNICIPIO M ON E.ID_MUNICIPIO = M.ID_MUNICIPIO
WHERE M.POPULACAO > 1000000

/*Atividade 27*/
SELECT F.ID_FORNECEDOR, P.NOME AS NOME_FORNECEDOR, SUM(IV.QUANTIDADE) AS TOTAL_PRODUTOS_VENDIDOS
FROM FORNECEDOR F
JOIN PRODUTO P ON F.ID_FORNECEDOR = P.ID_FORNECEDOR
JOIN ITENSVENDA IV ON P.ID_PRODUTO = IV.ID_PRODUTO
GROUP BY F.ID_FORNECEDOR, P.NOME

/*Atividade 28*/
SELECT p.NOME, v.VALOR_TOTAL FROM VENDA v 
LEFT JOIN PESSOA p ON v.ID_PESSOA = p.ID_PESSOA 
WHERE v.VALOR_TOTAL > 50

/*Atividade 29*/
SELECT PE.ID_PESSOA, PE.NOME, E.NUMERO, E.COMPLEMENTO, E.TIPO_ENDERECO FROM PESSOA PE
LEFT JOIN ENDERECO E ON PE.ID_PESSOA = E.ID_PESSOA

/*Atividade 30*/
SELECT P.ID_PRODUTO, P.NOME AS NOME_PRODUTO, P.PRECO_UNITARIO, PE.NOME AS NOME_FORNECEDOR FROM PRODUTO P
LEFT JOIN FORNECEDOR F ON P.ID_FORNECEDOR = F.ID_FORNECEDOR
LEFT JOIN PESSOA PE ON F.ID_PESSOA = PE.ID_PESSOA


/*Atividade 31*/
SELECT * FROM PRODUTO p
ORDER BY QUANTIDADE_ESTOQUE DESC 

/*Atividade 32*/
SELECT * FROM VENDA v 
ORDER BY VALOR_TOTAL ASC 

/*Atividade 33*/
SELECT p.NOME, p.QUANTIDADE_ESTOQUE FROM PRODUTO p
WHERE p.QUANTIDADE_ESTOQUE < (SELECT AVG(QUANTIDADE_ESTOQUE) FROM PRODUTO p)

/*Atividade 34*/
SELECT PE1.ID_PESSOA, PE1.NOME AS NOME_PESSOA, PE1.TELEFONE FROM PESSOA PE1
JOIN PESSOA PE2 ON PE1.TELEFONE = PE2.TELEFONE AND PE1.ID_PESSOA != PE2.ID_PESSOA


/*Atividade 35*/
UPDATE PRODUTO p
SET p.PRECO_UNITARIO = p.PRECO_UNITARIO + p.PRECO_UNITARIO * 0.10
WHERE p.ID_FORNECEDOR IN (SELECT f.id_fornecedor FROM FORNECEDOR f
INNER JOIN PESSOA pe ON f.id_pessoa = pe.id_pessoa
INNER JOIN ENDERECO e ON pe.id_pessoa = e.id_pessoa
INNER JOIN MUNICIPIO m ON e.id_municipio = m.id_municipio
WHERE m.nome = 'SP')

/*Atividade 36*/
SELECT V.ID_VENDA, V.VALOR_TOTAL, D.SITUACAO_DEBITO FROM VENDA V
JOIN DEBITOS D ON V.ID_VENDA = D.ID_VENDA
WHERE D.SITUACAO_DEBITO = 'Negociado'
